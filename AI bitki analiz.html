<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeliÅŸmiÅŸ TarÄ±mda Yapay Zeka Bitki Analizi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* AÃ§Ä±k yeÅŸil arka plan */
        }
        .container {
            max-width: 900px; /* GeniÅŸletilmiÅŸ container */
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .title {
            color: #166534; /* Koyu yeÅŸil baÅŸlÄ±k */
        }
        .button-primary {
            background-color: #22c55e; /* CanlÄ± yeÅŸil buton */
            color: white;
            transition: background-color 0.3s ease;
        }
        .button-primary:hover {
            background-color: #16a34a; /* Buton hover rengi */
        }
        .button-secondary {
            background-color: #6b7280;
            color: white;
            transition: background-color 0.3s ease;
        }
        .button-secondary:hover {
            background-color: #4b5563;
        }
        .image-preview-container {
            border: 2px dashed #a3e635; /* YeÅŸil kesikli Ã§erÃ§eve */
            min-height: 150px;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem;
        }
        .preview-image-item {
            max-width: 120px; /* Thumbnail boyutu */
            max-height: 120px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 0.375rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; /* Daha yukarÄ±da konumlandÄ±r */
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 550px;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-close-button {
            background-color: #ef4444; /* KÄ±rmÄ±zÄ± */
            color: white;
        }
        .modal-close-button:hover {
            background-color: #dc2626;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold title">ğŸŒ¿ GeliÅŸmiÅŸ TarÄ±mda Yapay Zeka Destekli Bitki Analizi ğŸŒ¿</h1>
            <p class="text-gray-600 mt-2">Bitkilerinizin fotoÄŸraflarÄ±nÄ± yÃ¼kleyin, notlarÄ±nÄ±zÄ± ekleyin ve analiz tÃ¼rÃ¼nÃ¼ seÃ§erek yapay zekadan detaylÄ± bilgi alÄ±n!</p>
        </header>

        <main>
            <section class="mb-6">
                <label for="plantImages" class="block text-sm font-medium text-gray-700 mb-2">Bitki FotoÄŸraflarÄ± SeÃ§in (Birden fazla seÃ§ebilirsiniz):</label>
                <input type="file" id="plantImages" accept="image/png, image/jpeg" multiple class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none p-2">
            </section>

            <section class="mb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-2">FotoÄŸraf Ã–nizleme</h2>
                <div id="imagePreviewContainer" class="image-preview-container rounded-lg bg-gray-50 justify-center items-center">
                    <p id="imagePlaceholder" class="text-gray-500 w-full text-center">LÃ¼tfen bir veya daha fazla fotoÄŸraf seÃ§in.</p>
                </div>
            </section>

            <section class="mb-6">
                <label for="analysisType" class="block text-sm font-medium text-gray-700 mb-2">Analiz TÃ¼rÃ¼ SeÃ§in:</label>
                <select id="analysisType" class="block w-full p-2.5 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    <option value="hastalik_zararli_tespiti">HastalÄ±k ve ZararlÄ± Tespiti</option>
                    <option value="besin_eksikligi">Besin EksikliÄŸi Analizi</option>
                    <option value="gelisim_takibi">Genel GeliÅŸim Takibi</option>
                    <option value="sulama_onerisi">Sulama Durumu ve Ã–nerisi</option>
                    <option value="toprak_yorumu">Toprak GÃ¶rÃ¼nÃ¼mÃ¼ Yorumlama (FotoÄŸraftan)</option>
                    <option value="genel_analiz">Genel Bitki SaÄŸlÄ±ÄŸÄ± Analizi (KapsamlÄ±)</option>
                </select>
            </section>

            <section class="mb-6">
                <label for="userNotes" class="block text-sm font-medium text-gray-700 mb-2">Ek Notlar veya SorularÄ±nÄ±z (Ä°steÄŸe BaÄŸlÄ±):</label>
                <textarea id="userNotes" rows="3" class="block w-full p-2.5 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Bitkileriniz hakkÄ±nda ek bilgi, gÃ¶zlemleriniz veya Ã¶zel sorularÄ±nÄ±zÄ± buraya yazabilirsiniz..."></textarea>
            </section>

            <section class="text-center mb-6 space-x-4">
                <button id="analyzeButton" class="button-primary font-semibold py-3 px-6 rounded-lg shadow-md disabled:opacity-50" disabled>
                    Analiz Et
                </button>
                <button id="clearButton" class="button-secondary font-semibold py-3 px-6 rounded-lg shadow-md">
                    Temizle
                </button>
            </section>

            <div id="loader" class="loader hidden"></div>

            <section id="resultsSection" class="hidden mt-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ” Analiz SonuÃ§larÄ±:</h2>
                <div id="analysisResult" class="p-5 border border-gray-200 rounded-lg bg-gray-100 min-h-[150px] whitespace-pre-wrap shadow">
                    </div>
            </section>
        </main>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-xl font-semibold mb-4">Bilgi</h3>
            <p id="modalMessage" class="mb-6 text-gray-700">MesajÄ±nÄ±z burada.</p>
            <button id="modalClose" class="modal-close-button font-semibold py-2 px-5 rounded-lg">Kapat</button>
        </div>
    </div>

    <script>
        const plantImagesInput = document.getElementById('plantImages');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePlaceholder = document.getElementById('imagePlaceholder');
        const analyzeButton = document.getElementById('analyzeButton');
        const clearButton = document.getElementById('clearButton');
        const loader = document.getElementById('loader');
        const resultsSection = document.getElementById('resultsSection');
        const analysisResultDiv = document.getElementById('analysisResult');
        const userNotesInput = document.getElementById('userNotes');
        const analysisTypeSelect = document.getElementById('analysisType');

        // Modal elementleri
        const infoModal = document.getElementById('infoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseButton = document.getElementById('modalClose');

        let imageFilesData = []; // { data: base64String, mimeType: string, name: string }

        // Modal gÃ¶sterme fonksiyonu
        function showModal(title, message, isError = false) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.classList.remove('text-green-700', 'text-red-700');
            if (isError) {
                modalTitle.classList.add('text-red-700');
            } else {
                modalTitle.classList.add('text-green-700');
            }
            infoModal.style.display = 'flex';
        }

        // Modal kapatma
        modalCloseButton.onclick = function() { infoModal.style.display = 'none'; }
        window.onclick = function(event) {
            if (event.target == infoModal) {
                infoModal.style.display = 'none';
            }
        }

        function resetForm() {
            plantImagesInput.value = ''; // Dosya seÃ§imini temizle
            imageFilesData = [];
            imagePreviewContainer.innerHTML = ''; // Ã–nizlemeleri temizle
            imagePreviewContainer.appendChild(imagePlaceholder); // Placeholder'Ä± geri ekle
            imagePlaceholder.classList.remove('hidden');
            userNotesInput.value = '';
            analysisTypeSelect.selectedIndex = 0;
            analyzeButton.disabled = true;
            resultsSection.classList.add('hidden');
            analysisResultDiv.textContent = '';
            loader.classList.add('hidden');
        }

        clearButton.addEventListener('click', resetForm);

        plantImagesInput.addEventListener('change', function(event) {
            const files = event.target.files;
            imageFilesData = []; // Her yeni seÃ§imde listeyi sÄ±fÄ±rla
            imagePreviewContainer.innerHTML = ''; // Ã–nceki Ã¶nizlemeleri temizle

            if (files.length === 0) {
                imagePreviewContainer.appendChild(imagePlaceholder);
                imagePlaceholder.classList.remove('hidden');
                analyzeButton.disabled = true;
                return;
            }

            imagePlaceholder.classList.add('hidden');
            let validFilesExist = false;
            let filesProcessed = 0; // Ä°ÅŸlenen dosya sayÄ±sÄ±nÄ± takip et

            Array.from(files).forEach(file => {
                // Dosya boyutu kontrolÃ¼ (Ã¶rneÄŸin 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showModal('Hata', `'${file.name}' adlÄ± dosya Ã§ok bÃ¼yÃ¼k (Max 5MB).`, true);
                    filesProcessed++;
                    if (filesProcessed === files.length) { // TÃ¼m dosyalar iÅŸlendiyse buton durumunu gÃ¼ncelle
                        analyzeButton.disabled = imageFilesData.length === 0;
                    }
                    return; // Bu dosyayÄ± atla
                }

                // Dosya tipi kontrolÃ¼
                if (!['image/jpeg', 'image/png'].includes(file.type)) {
                    showModal('Hata', `'${file.name}' geÃ§ersiz dosya tipi (Sadece JPEG/PNG).`, true);
                    filesProcessed++;
                     if (filesProcessed === files.length) {
                        analyzeButton.disabled = imageFilesData.length === 0;
                    }
                    return; // Bu dosyayÄ± atla
                }

                validFilesExist = true;
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageFilesData.push({
                        data: e.target.result.split(',')[1], // Base64 verisi
                        mimeType: file.type,
                        name: file.name
                    });

                    const imgElement = document.createElement('img');
                    imgElement.src = e.target.result;
                    imgElement.alt = `Ã–nizleme: ${file.name}`;
                    imgElement.classList.add('preview-image-item');
                    imagePreviewContainer.appendChild(imgElement);

                    filesProcessed++;
                    if (filesProcessed === files.length) { // TÃ¼m dosyalar (geÃ§erli/geÃ§ersiz) iÅŸlendikten sonra
                         analyzeButton.disabled = imageFilesData.length === 0; // Sadece geÃ§erli resim varsa aktif et
                    }
                }
                reader.onerror = function() {
                    showModal('Hata', `'${file.name}' okunurken bir hata oluÅŸtu.`, true);
                    filesProcessed++;
                    if (filesProcessed === files.length) {
                        analyzeButton.disabled = imageFilesData.length === 0;
                    }
                }
                reader.readAsDataURL(file);
            });

            if (files.length > 0 && !validFilesExist && filesProcessed === files.length) {
                 imagePreviewContainer.appendChild(imagePlaceholder);
                 imagePlaceholder.classList.remove('hidden');
                 analyzeButton.disabled = true;
            } else if (files.length === 0) { // HiÃ§ dosya seÃ§ilmediyse
                 analyzeButton.disabled = true;
            }
        });

        analyzeButton.addEventListener('click', async function() {
            if (imageFilesData.length === 0) {
                showModal('UyarÄ±', 'LÃ¼tfen Ã¶nce analiz iÃ§in en az bir fotoÄŸraf seÃ§in.', true);
                return;
            }

            loader.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            analysisResultDiv.textContent = '';
            analyzeButton.disabled = true;
            clearButton.disabled = true;

            const notes = userNotesInput.value.trim();
            const analysisType = analysisTypeSelect.value;
            const analysisTypeFriendlyName = analysisTypeSelect.options[analysisTypeSelect.selectedIndex].text;

            let promptText = `Bu bitki fotoÄŸraf(lar)Ä±nÄ± analiz et. SeÃ§ilen analiz tÃ¼rÃ¼: "${analysisTypeFriendlyName}".\n`;
            promptText += `KullanÄ±cÄ±nÄ±n ek notlarÄ±/sorularÄ±: "${notes || 'Yok'}".\n\n`;

            switch(analysisType) {
                case "hastalik_zararli_tespiti":
                    promptText += "Bitki(ler)de herhangi bir hastalÄ±k belirtisi, mantar, bÃ¶cek veya zararlÄ± varlÄ±ÄŸÄ± gÃ¶rÃ¼nÃ¼yor mu? Varsa, olasÄ± teÅŸhisler nelerdir? DetaylÄ± bir aÃ§Ä±klama ve Ã¶ncelikli olarak biyolojik/organik mÃ¼cadele yÃ¶ntemleri dahil Ã§Ã¶zÃ¼m Ã¶nerileri sun.";
                    break;
                case "besin_eksikligi":
                    promptText += "Bitki(ler)deki yaprak rengi, ÅŸekli, duruÅŸu ve genel gÃ¶rÃ¼nÃ¼me bakarak olasÄ± besin eksikliklerini (Ã¶rneÄŸin Azot, Fosfor, Potasyum, Magnezyum, Demir vb.) analiz et. Belirtileri, eksikliÄŸin olasÄ± nedenlerini ve organik gÃ¼breleme/besin takviyesi Ã¶nerilerini detaylandÄ±r.";
                    break;
                case "gelisim_takibi":
                    promptText += "Bitki(ler)nin genel saÄŸlÄ±k ve geliÅŸim durumunu (bÃ¼yÃ¼me hÄ±zÄ±, yaprak yoÄŸunluÄŸu, gÃ¶vde canlÄ±lÄ±ÄŸÄ± vb.) deÄŸerlendir. GeliÅŸimi iyileÅŸtirmek iÃ§in genel ve pratik tavsiyeler sun.";
                    break;
                case "sulama_onerisi":
                    promptText += "Bitki(ler)nin ve eÄŸer gÃ¶rÃ¼nÃ¼yorsa topraÄŸÄ±n gÃ¶rÃ¼nÃ¼mÃ¼ne bakarak sulama ihtiyacÄ±nÄ± deÄŸerlendir. Bitki(ler) susuzluk veya aÅŸÄ±rÄ± sulama belirtileri gÃ¶steriyor mu? Toprak nem durumu hakkÄ±nda bir Ã§Ä±karÄ±m yapÄ±labilir mi? Sulama sÄ±klÄ±ÄŸÄ±, miktarÄ± ve tekniÄŸi konusunda genel Ã¶neriler sun.";
                    break;
                case "toprak_yorumu":
                    promptText += "EÄŸer fotoÄŸraflarda toprak net bir ÅŸekilde gÃ¶rÃ¼nÃ¼yorsa, topraÄŸÄ±n rengi, yapÄ±sÄ± (kumlu, killi, tÄ±nlÄ± vb. olasÄ± Ã§Ä±karÄ±mlar) ve yÃ¼zeydeki organik madde belirtileri hakkÄ±nda yorum yap. Toprak kalitesini iyileÅŸtirmek iÃ§in genel ve organik yÃ¶ntemler Ã¶ner. Bu analizin sadece gÃ¶rsel bir yorum olduÄŸunu, kesin sonuÃ§lar iÃ§in laboratuvar analizi gerektiÄŸini belirt.";
                    break;
                case "genel_analiz":
                    promptText += "Bitki(ler)nin genel saÄŸlÄ±k durumunu kapsamlÄ± bir ÅŸekilde analiz et. OlasÄ± hastalÄ±k, zararlÄ±, besin eksikliÄŸi veya geliÅŸim sorunlarÄ±na deÄŸin. Her bir tespit iÃ§in kÄ±sa aÃ§Ä±klamalar ve Ã§Ã¶zÃ¼m Ã¶nerileri sun. Genel bakÄ±m tavsiyeleri ver.";
                    break;
                default:
                    promptText += "LÃ¼tfen yÃ¼klenen gÃ¶rsellerdeki bitkileri genel tarÄ±msal prensipler Ã§erÃ§evesinde deÄŸerlendir ve gÃ¶zlemlerini paylaÅŸ.";
            }
            promptText += "\n\nAnalizini net, anlaÅŸÄ±lÄ±r ve maddeler halinde sunmaya Ã§alÄ±ÅŸ. Birden fazla fotoÄŸraf varsa, her birini dikkate alarak genel bir deÄŸerlendirme yap veya Ã¶nemli farklÄ±lÄ±klar varsa belirt.";


            const parts = [{ text: promptText }];
            imageFilesData.forEach(imgData => {
                parts.push({
                    inlineData: {
                        mimeType: imgData.mimeType,
                        data: imgData.data
                    }
                });
            });

            const payload = { contents: [{ role: "user", parts: parts }] };
            const apiKey = ""; // Canvas ortamÄ±nda otomatik saÄŸlanÄ±r
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorStatus = response.status;
                    let errorResponseMessage = `API'den hata alÄ±ndÄ±: ${errorStatus}`;
                    let modalErrorMessage = `API'den ${errorStatus} durum kodu ile bir hata alÄ±ndÄ±.`;

                    if (errorStatus === 401) {
                        modalErrorMessage = "API Yetkilendirme HatasÄ± (401): Servise eriÅŸim iÃ§in geÃ§erli kimlik bilgileri saÄŸlanamadÄ±. LÃ¼tfen API anahtarÄ±nÄ±zÄ±n doÄŸru yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±ndan veya ortamÄ±nÄ±zÄ±n API eriÅŸimine izin verdiÄŸinden emin olun.";
                        errorResponseMessage += " - Yetkilendirme HatasÄ±.";
                    }

                    try {
                        const errorBody = await response.text(); // Hata yanÄ±tÄ±nÄ± metin olarak oku
                        if (errorBody) {
                            try {
                                const errorData = JSON.parse(errorBody); // JSON olarak ayrÄ±ÅŸtÄ±rmayÄ± dene
                                if (errorData && errorData.error && errorData.error.message) {
                                    errorResponseMessage += ` - ${errorData.error.message}`;
                                    if (errorStatus !== 401) modalErrorMessage += ` Detay: ${errorData.error.message}`;
                                } else {
                                    errorResponseMessage += ` - YanÄ±t: ${errorBody.substring(0, 200)}${errorBody.length > 200 ? '...' : ''}`;
                                    if (errorStatus !== 401) modalErrorMessage += ` Sunucu yanÄ±tÄ±: ${errorBody.substring(0,100)}...`;
                                }
                                console.error('API Hata DetayÄ± (JSON):', errorData);
                            } catch (e) {
                                errorResponseMessage += ` - YanÄ±t: ${errorBody.substring(0, 200)}${errorBody.length > 200 ? '...' : ''}`;
                                if (errorStatus !== 401) modalErrorMessage += ` Sunucu yanÄ±tÄ± (JSON deÄŸil): ${errorBody.substring(0,100)}...`;
                                console.error('API Hata Metni (JSON deÄŸil):', errorBody);
                            }
                        } else {
                            errorResponseMessage += " - Sunucudan boÅŸ hata yanÄ±tÄ± alÄ±ndÄ±.";
                            if (errorStatus !== 401) modalErrorMessage += " Sunucudan boÅŸ yanÄ±t alÄ±ndÄ±.";
                            console.error('API Hata: Sunucudan boÅŸ yanÄ±t alÄ±ndÄ±.');
                        }
                    } catch (textError) {
                        errorResponseMessage += " - Hata yanÄ±tÄ± okunamadÄ±.";
                        if (errorStatus !== 401) modalErrorMessage += " Hata yanÄ±tÄ± sunucudan okunamadÄ±.";
                        console.error('API Hata: Hata yanÄ±tÄ± okunamadÄ±', textError);
                    }
                    // Hata mesajÄ±nÄ± modalda gÃ¶ster
                    showModal('Analiz HatasÄ±', modalErrorMessage, true);
                    analysisResultDiv.textContent = `Bir hata oluÅŸtu: ${errorResponseMessage}. LÃ¼tfen konsolu kontrol edin.`;
                    resultsSection.classList.remove('hidden'); // Hata mesajÄ±nÄ± gÃ¶stermek iÃ§in
                    // throw new Error(errorResponseMessage); // Hata fÄ±rlatmak yerine kullanÄ±cÄ±ya modalda gÃ¶sterdik
                    return; // Hata sonrasÄ± devam etme
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0 &&
                    result.candidates[0].content.parts[0].text) {
                    const analysisText = result.candidates[0].content.parts[0].text;
                    analysisResultDiv.textContent = analysisText;
                    resultsSection.classList.remove('hidden');
                    showModal('Analiz TamamlandÄ±', 'Bitki analiziniz baÅŸarÄ±yla tamamlandÄ±. SonuÃ§larÄ± aÅŸaÄŸÄ±da gÃ¶rebilirsiniz.', false);
                } else {
                    console.error('API YanÄ±t FormatÄ± Beklenmedik:', result);
                     let detailedError = 'Yapay zekadan geÃ§erli bir analiz alÄ±namadÄ±.';
                    if (result.promptFeedback && result.promptFeedback.blockReason) {
                        detailedError += ` Engelleme nedeni: ${result.promptFeedback.blockReason.reason || result.promptFeedback.blockReason}`;
                        if (result.promptFeedback.safetyRatings) {
                             detailedError += ` GÃ¼venlik deÄŸerlendirmeleri: ${JSON.stringify(result.promptFeedback.safetyRatings)}`;
                        }
                    } else if (result.candidates && result.candidates.length > 0 && result.candidates[0].finishReason && result.candidates[0].finishReason !== 'STOP') {
                         detailedError += ` Bitirme nedeni: ${result.candidates[0].finishReason}.`;
                         if (result.candidates[0].safetyRatings) {
                            detailedError += ` GÃ¼venlik deÄŸerlendirmeleri: ${JSON.stringify(result.candidates[0].safetyRatings)}`;
                         }
                    }
                    // throw new Error(detailedError); // Hata fÄ±rlatmak yerine kullanÄ±cÄ±ya modalda gÃ¶ster
                    showModal('Analiz HatasÄ±', detailedError, true);
                    analysisResultDiv.textContent = detailedError;
                    resultsSection.classList.remove('hidden');
                }

            } catch (error) { // Bu catch bloÄŸu fetch dÄ±ÅŸÄ±ndaki hatalar veya yukarÄ±da throw edilirse yakalar
                console.error('Analiz sÄ±rasÄ±nda genel hata:', error);
                // EÄŸer hata zaten modalda gÃ¶sterilmediyse (Ã¶rn. fetch Ã¶ncesi bir hata)
                if (infoModal.style.display !== 'flex') {
                    showModal('Analiz HatasÄ±', `Beklenmedik bir sorun oluÅŸtu: ${error.message}. GeliÅŸtirici konsolunu kontrol edin.`, true);
                }
                if (!analysisResultDiv.textContent) { // EÄŸer sonuÃ§ div'i zaten bir hata mesajÄ± iÃ§ermiyorsa
                    analysisResultDiv.textContent = `Bir hata oluÅŸtu: ${error.message}.`;
                }
                resultsSection.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
                analyzeButton.disabled = imageFilesData.length === 0;
                clearButton.disabled = false;
            }
        });

        // Sayfa yÃ¼klendiÄŸinde formu sÄ±fÄ±rla
        resetForm();
    </script>
</body>
</html>
