<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern TarÄ±mda Yapay Zeka Bitki Analizi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* AÃ§Ä±k yeÅŸil arka plan */
            overflow-x: hidden; /* Yatay kaydÄ±rmayÄ± engelle */
        }
        .container-main { /* Ana iÃ§erik container'Ä± iÃ§in yeni class */
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .app-title { /* Ana baÅŸlÄ±k iÃ§in Ã¶zel class */
            color: #166534; /* Koyu yeÅŸil baÅŸlÄ±k */
        }
        .button-primary {
            background-color: #22c55e; /* CanlÄ± yeÅŸil buton */
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .button-primary:hover {
            background-color: #16a34a; /* Buton hover rengi */
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .button-primary:disabled {
            transform: translateY(0);
            box-shadow: none;
        }
        .button-secondary {
            background-color: #6b7280;
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .button-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .image-preview-container {
            border: 2px dashed #a3e635; /* YeÅŸil kesikli Ã§erÃ§eve */
            min-height: 150px;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
        }
        .preview-image-item {
            max-width: 120px;
            max-height: 120px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 0.375rem;
            opacity: 0; /* Animasyon iÃ§in baÅŸlangÄ±Ã§ */
            animation: fadeInImage 0.5s ease-out forwards;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal AnimasyonlarÄ± */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            opacity: 0; /* Animasyon iÃ§in baÅŸlangÄ±Ã§ */
            transition: opacity 0.3s ease-in-out;
        }
        .modal.active {
            opacity: 1;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 550px;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: scale(0.95) translateY(-20px); /* Animasyon iÃ§in baÅŸlangÄ±Ã§ */
            opacity: 0;
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease-in-out;
        }
        .modal.active .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        .modal-close-button {
            background-color: #ef4444;
            color: white;
            transition: background-color 0.3s ease;
        }
        .modal-close-button:hover {
            background-color: #dc2626;
        }

        /* BÃ¶lÃ¼m GiriÅŸ AnimasyonlarÄ± */
        .animated-section {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .animated-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        @keyframes fadeInImage {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .nav-link {
            position: relative;
            transition: color 0.3s ease;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #d1fae5; /* AÃ§Ä±k yeÅŸil alt Ã§izgi */
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .nav-link:hover {
            color: #d1fae5;
        }

    </style>
</head>
<body class="antialiased">

    <nav class="bg-green-700 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center max-w-screen-xl">
            <div class="text-2xl font-bold tracking-tight">AI FotoÄŸraf TarÄ±m Analizi</div>
	    <div class="text-1xl font-italic">Created by ozkanahmet </div>

            <div>
                <a href="#" class="nav-link px-3 py-2 rounded text-lg">Ana Sayfa</a>
                <!-- <a href="#" class="nav-link px-3 py-2 rounded text-lg ml-2">HakkÄ±mÄ±zda</a> -->
                <!-- <a href="#" class="nav-link px-3 py-2 rounded text-lg ml-2">Ä°letiÅŸim</a> -->
            </div>
        </div>
    </nav>

    <div class="container-main">
        <header class="text-center mb-10 animated-section">
            <h1 class="text-4xl font-bold app-title">ğŸŒ¿ TarÄ±mda Yapay Zeka Destekli Bitki Analizi ğŸŒ¿</h1>
            <p class="text-gray-700 mt-3 text-lg">Bitkilerinizin fotoÄŸraflarÄ±nÄ± net sonuÃ§ iÃ§in net ve her tÃ¼rlÃ¼ detayÄ±nÄ± yÃ¼kleyin, notlarÄ±nÄ±zÄ± ekleyin ve analiz tÃ¼rÃ¼nÃ¼ seÃ§erek yapay zekadan detaylÄ± bilgi alÄ±n!</p>
        </header>

        <main>
            <section class="mb-8 p-6 bg-white rounded-lg shadow-sm border border-gray-200 animated-section">
                <label for="plantImages" class="block text-lg font-medium text-gray-800 mb-2">Bitki FotoÄŸraflarÄ± SeÃ§in (Birden fazla seÃ§ebilirsiniz):</label>
                <input type="file" id="plantImages" accept="image/png, image/jpeg" multiple class="block w-full text-base text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 p-3 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition-colors">
            </section>

            <section class="mb-8 animated-section">
                <h2 class="text-2xl font-semibold text-gray-800 mb-3">FotoÄŸraf Ã–nizleme</h2>
                <div id="imagePreviewContainer" class="image-preview-container rounded-lg ">
                    <p id="imagePlaceholder" class="text-gray-500 w-full text-center text-lg">LÃ¼tfen bir veya daha fazla fotoÄŸraf seÃ§in.</p>
                </div>
            </section>

            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <section class="p-6 bg-white rounded-lg shadow-sm border border-gray-200 animated-section">
                    <label for="analysisType" class="block text-lg font-medium text-gray-800 mb-2">Analiz TÃ¼rÃ¼ SeÃ§in:</label>
                    <select id="analysisType" class="block w-full p-3.5 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 text-base">
                        <option value="hastalik_zararli_tespiti">HastalÄ±k ve ZararlÄ± Tespiti</option>
                        <option value="besin_eksikligi">Besin EksikliÄŸi Analizi</option>
                        <option value="gelisim_takibi">Genel GeliÅŸim Takibi</option>
                        <option value="sulama_onerisi">Sulama Durumu ve Ã–nerisi</option>
                        <option value="toprak_yorumu">Toprak GÃ¶rÃ¼nÃ¼mÃ¼ Yorumlama (FotoÄŸraftan)</option>
                        <option value="genel_analiz">Genel Bitki SaÄŸlÄ±ÄŸÄ± Analizi (KapsamlÄ±)</option>
                    </select>
                </section>

                <section class="p-6 bg-white rounded-lg shadow-sm border border-gray-200 animated-section">
                    <label for="userNotes" class="block text-lg font-medium text-gray-800 mb-2">Ek Notlar veya SorularÄ±nÄ±z (Ä°steÄŸe BaÄŸlÄ±):</label>
                    <textarea id="userNotes" rows="3" class="block w-full p-3.5 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 text-base" placeholder="GÃ¶zlemleriniz, sorularÄ±nÄ±z..."></textarea>
                </section>
            </div>

            <section class="text-center mb-8 space-x-4 animated-section">
                <button id="analyzeButton" class="button-primary font-semibold py-3 px-8 rounded-lg shadow-md text-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Analiz Et
                </button>
                <button id="clearButton" class="button-secondary font-semibold py-3 px-8 rounded-lg shadow-md text-lg">
                    Temizle
                </button>
            </section>

            <div id="loader" class="loader hidden"></div>

            <section id="resultsSection" class="hidden mt-10 p-6 bg-green-50 rounded-lg shadow-md border border-green-200 animated-section">
                <h2 class="text-3xl font-semibold text-green-700 mb-5">ğŸ” Analiz SonuÃ§larÄ±:</h2>
                <div id="analysisResult" class="p-5 border border-gray-200 rounded-lg bg-white min-h-[150px] whitespace-pre-wrap shadow-inner text-gray-700 leading-relaxed">
                    <!-- Yapay zeka cevabÄ± buraya gelecek -->
                </div>
            </section>
        </main>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-2xl font-semibold mb-5">Bilgi</h3>
            <p id="modalMessage" class="mb-7 text-gray-700 text-base">MesajÄ±nÄ±z burada.</p>
            <button id="modalClose" class="modal-close-button font-semibold py-2.5 px-6 rounded-lg text-base">Kapat</button>
        </div>
    </div>

    <script>
        const plantImagesInput = document.getElementById('plantImages');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePlaceholder = document.getElementById('imagePlaceholder');
        const analyzeButton = document.getElementById('analyzeButton');
        const clearButton = document.getElementById('clearButton');
        const loader = document.getElementById('loader');
        const resultsSection = document.getElementById('resultsSection');
        const analysisResultDiv = document.getElementById('analysisResult');
        const userNotesInput = document.getElementById('userNotes');
        const analysisTypeSelect = document.getElementById('analysisType');

        const infoModal = document.getElementById('infoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseButton = document.getElementById('modalClose');

        let imageFilesData = [];

        function showModal(title, message, isError = false) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.classList.remove('text-green-700', 'text-red-700');
            if (isError) {
                modalTitle.classList.add('text-red-700');
            } else {
                modalTitle.classList.add('text-green-700');
            }
            infoModal.style.display = 'flex';
            setTimeout(() => { // Aktivasyon iÃ§in kÄ±sa bir gecikme
                infoModal.classList.add('active');
            }, 10);
        }

        function closeModal() {
            infoModal.classList.remove('active');
            setTimeout(() => {
                infoModal.style.display = 'none';
            }, 300); // CSS transition sÃ¼resiyle eÅŸleÅŸmeli
        }

        modalCloseButton.onclick = closeModal;
        window.onclick = function(event) {
            if (event.target == infoModal) {
                closeModal();
            }
        }

        function resetForm() {
            plantImagesInput.value = '';
            imageFilesData = [];
            imagePreviewContainer.innerHTML = '';
            imagePreviewContainer.appendChild(imagePlaceholder);
            imagePlaceholder.classList.remove('hidden');
            userNotesInput.value = '';
            analysisTypeSelect.selectedIndex = 0;
            analyzeButton.disabled = true;
            resultsSection.classList.add('hidden');
            resultsSection.classList.remove('visible'); // Animasyon iÃ§in
            analysisResultDiv.textContent = '';
            loader.classList.add('hidden');
        }

        clearButton.addEventListener('click', resetForm);

        plantImagesInput.addEventListener('change', function(event) {
            const files = event.target.files;
            imageFilesData = [];
            imagePreviewContainer.innerHTML = '';

            if (files.length === 0) {
                imagePreviewContainer.appendChild(imagePlaceholder);
                imagePlaceholder.classList.remove('hidden');
                analyzeButton.disabled = true;
                return;
            }

            imagePlaceholder.classList.add('hidden');
            let validFilesExist = false;
            let filesProcessed = 0;

            Array.from(files).forEach(file => {
                if (file.size > 5 * 1024 * 1024) {
                    showModal('Hata', `'${file.name}' adlÄ± dosya Ã§ok bÃ¼yÃ¼k (Max 5MB).`, true);
                    filesProcessed++;
                    if (filesProcessed === files.length) {
                        analyzeButton.disabled = imageFilesData.length === 0;
                    }
                    return;
                }
                if (!['image/jpeg', 'image/png'].includes(file.type)) {
                    showModal('Hata', `'${file.name}' geÃ§ersiz dosya tipi (Sadece JPEG/PNG).`, true);
                    filesProcessed++;
                     if (filesProcessed === files.length) {
                        analyzeButton.disabled = imageFilesData.length === 0;
                    }
                    return;
                }

                validFilesExist = true;
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageFilesData.push({
                        data: e.target.result.split(',')[1],
                        mimeType: file.type,
                        name: file.name
                    });

                    const imgElement = document.createElement('img');
                    imgElement.src = e.target.result;
                    imgElement.alt = `Ã–nizleme: ${file.name}`;
                    imgElement.classList.add('preview-image-item'); // Animasyon class'Ä± CSS'de tanÄ±mlÄ±
                    imagePreviewContainer.appendChild(imgElement);

                    filesProcessed++;
                    if (filesProcessed === files.length) {
                         analyzeButton.disabled = imageFilesData.length === 0;
                    }
                }
                reader.onerror = function() {
                    showModal('Hata', `'${file.name}' okunurken bir hata oluÅŸtu.`, true);
                    filesProcessed++;
                    if (filesProcessed === files.length) {
                        analyzeButton.disabled = imageFilesData.length === 0;
                    }
                }
                reader.readAsDataURL(file);
            });

            if (files.length > 0 && !validFilesExist && filesProcessed === files.length) {
                 imagePreviewContainer.appendChild(imagePlaceholder);
                 imagePlaceholder.classList.remove('hidden');
                 analyzeButton.disabled = true;
            } else if (files.length === 0) {
                 analyzeButton.disabled = true;
            }
        });

        analyzeButton.addEventListener('click', async function() {
            if (imageFilesData.length === 0) {
                showModal('UyarÄ±', 'LÃ¼tfen Ã¶nce analiz iÃ§in en az bir fotoÄŸraf seÃ§in.', true);
                return;
            }

            loader.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            resultsSection.classList.remove('visible');
            analysisResultDiv.textContent = '';
            analyzeButton.disabled = true;
            clearButton.disabled = true;

            const notes = userNotesInput.value.trim();
            const analysisType = analysisTypeSelect.value;
            const analysisTypeFriendlyName = analysisTypeSelect.options[analysisTypeSelect.selectedIndex].text;

            let promptText = `Bu bitki fotoÄŸraf(lar)Ä±nÄ± analiz et. SeÃ§ilen analiz tÃ¼rÃ¼: "${analysisTypeFriendlyName}".\n`;
            promptText += `KullanÄ±cÄ±nÄ±n ek notlarÄ±/sorularÄ±: "${notes || 'Yok'}".\n\n`;
            // ... (switch case for promptText remains the same)
             switch(analysisType) {
                case "hastalik_zararli_tespiti":
                    promptText += "Bitki(ler)de herhangi bir hastalÄ±k belirtisi, mantar, bÃ¶cek veya zararlÄ± varlÄ±ÄŸÄ± gÃ¶rÃ¼nÃ¼yor mu? Varsa, olasÄ± teÅŸhisler nelerdir? DetaylÄ± bir aÃ§Ä±klama ve Ã¶ncelikli olarak biyolojik/organik mÃ¼cadele yÃ¶ntemleri dahil Ã§Ã¶zÃ¼m Ã¶nerileri sun.";
                    break;
                case "besin_eksikligi":
                    promptText += "Bitki(ler)deki yaprak rengi, ÅŸekli, duruÅŸu ve genel gÃ¶rÃ¼nÃ¼me bakarak olasÄ± besin eksikliklerini (Ã¶rneÄŸin Azot, Fosfor, Potasyum, Magnezyum, Demir vb.) analiz et. Belirtileri, eksikliÄŸin olasÄ± nedenlerini ve organik gÃ¼breleme/besin takviyesi Ã¶nerilerini detaylandÄ±r.";
                    break;
                case "gelisim_takibi":
                    promptText += "Bitki(ler)nin genel saÄŸlÄ±k ve geliÅŸim durumunu (bÃ¼yÃ¼me hÄ±zÄ±, yaprak yoÄŸunluÄŸu, gÃ¶vde canlÄ±lÄ±ÄŸÄ± vb.) deÄŸerlendir. GeliÅŸimi iyileÅŸtirmek iÃ§in genel ve pratik tavsiyeler sun.";
                    break;
                case "sulama_onerisi":
                    promptText += "Bitki(ler)nin ve eÄŸer gÃ¶rÃ¼nÃ¼yorsa topraÄŸÄ±n gÃ¶rÃ¼nÃ¼mÃ¼ne bakarak sulama ihtiyacÄ±nÄ± deÄŸerlendir. Bitki(ler) susuzluk veya aÅŸÄ±rÄ± sulama belirtileri gÃ¶steriyor mu? Toprak nem durumu hakkÄ±nda bir Ã§Ä±karÄ±m yapÄ±labilir mi? Sulama sÄ±klÄ±ÄŸÄ±, miktarÄ± ve tekniÄŸi konusunda genel Ã¶neriler sun.";
                    break;
                case "toprak_yorumu":
                    promptText += "EÄŸer fotoÄŸraflarda toprak net bir ÅŸekilde gÃ¶rÃ¼nÃ¼yorsa, topraÄŸÄ±n rengi, yapÄ±sÄ± (kumlu, killi, tÄ±nlÄ± vb. olasÄ± Ã§Ä±karÄ±mlar) ve yÃ¼zeydeki organik madde belirtileri hakkÄ±nda yorum yap. Toprak kalitesini iyileÅŸtirmek iÃ§in genel ve organik yÃ¶ntemler Ã¶ner. Bu analizin sadece gÃ¶rsel bir yorum olduÄŸunu, kesin sonuÃ§lar iÃ§in laboratuvar analizi gerektiÄŸini belirt.";
                    break;
                case "genel_analiz":
                    promptText += "Bitki(ler)nin genel saÄŸlÄ±k durumunu kapsamlÄ± bir ÅŸekilde analiz et. OlasÄ± hastalÄ±k, zararlÄ±, besin eksikliÄŸi veya geliÅŸim sorunlarÄ±na deÄŸin. Her bir tespit iÃ§in kÄ±sa aÃ§Ä±klamalar ve Ã§Ã¶zÃ¼m Ã¶nerileri sun. Genel bakÄ±m tavsiyeleri ver.";
                    break;
                default:
                    promptText += "LÃ¼tfen yÃ¼klenen gÃ¶rsellerdeki bitkileri genel tarÄ±msal prensipler Ã§erÃ§evesinde deÄŸerlendir ve gÃ¶zlemlerini paylaÅŸ.";
            }
            promptText += "\n\nAnalizini net, anlaÅŸÄ±lÄ±r ve maddeler halinde sunmaya Ã§alÄ±ÅŸ. Birden fazla fotoÄŸraf varsa, her birini dikkate alarak genel bir deÄŸerlendirme yap veya Ã¶nemli farklÄ±lÄ±klar varsa belirt.";


            const parts = [{ text: promptText }];
            imageFilesData.forEach(imgData => {
                parts.push({
                    inlineData: {
                        mimeType: imgData.mimeType,
                        data: imgData.data
                    }
                });
            });

            const payload = { contents: [{ role: "user", parts: parts }] };
            const apiKey = "AIzaSyDkgRnTa9UqOlFEtUqhkAAs5XkI-IfDfcY"; // Canvas ortamÄ±nda otomatik saÄŸlanÄ±r veya kullanÄ±cÄ± kendi anahtarÄ±nÄ± girmelidir.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // ... (Error handling remains the same)
                    const errorStatus = response.status;
                    let errorResponseMessage = `API'den hata alÄ±ndÄ±: ${errorStatus}`;
                    let modalErrorMessage = `API'den ${errorStatus} durum kodu ile bir hata alÄ±ndÄ±.`;

                    if (errorStatus === 401) {
                        modalErrorMessage = "API Yetkilendirme HatasÄ± (401): Servise eriÅŸim iÃ§in geÃ§erli kimlik bilgileri saÄŸlanamadÄ±. LÃ¼tfen API anahtarÄ±nÄ±zÄ±n doÄŸru yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±ndan veya ortamÄ±nÄ±zÄ±n API eriÅŸimine izin verdiÄŸinden emin olun. EÄŸer bu uygulamayÄ± kendi bilgisayarÄ±nÄ±zda Ã§alÄ±ÅŸtÄ±rÄ±yorsanÄ±z, kod iÃ§erisindeki 'apiKey' deÄŸiÅŸkenine geÃ§erli bir Google AI Studio API anahtarÄ± girmeniz gerekmektedir.";
                        errorResponseMessage += " - Yetkilendirme HatasÄ±.";
                    } else if (errorStatus === 403) {
                         modalErrorMessage = "API EriÅŸim Reddi (403): API'ye eriÅŸiminiz reddedildi. Bu, API anahtarÄ±nÄ±zÄ±n yanlÄ±ÅŸ olmasÄ±, gerekli API'nin etkinleÅŸtirilmemiÅŸ olmasÄ± veya baÅŸka bir izin sorunu nedeniyle olabilir. LÃ¼tfen Google Cloud Console veya AI Studio ayarlarÄ±nÄ±zÄ± kontrol edin. EÄŸer bu uygulamayÄ± kendi bilgisayarÄ±nÄ±zda Ã§alÄ±ÅŸtÄ±rÄ±yorsanÄ±z, kod iÃ§erisindeki 'apiKey' deÄŸiÅŸkenine geÃ§erli bir Google AI Studio API anahtarÄ± girmeniz gerekmektedir.";
                        errorResponseMessage += " - EriÅŸim Reddi.";
                    }


                    try {
                        const errorBody = await response.text();
                        if (errorBody) {
                            try {
                                const errorData = JSON.parse(errorBody);
                                if (errorData && errorData.error && errorData.error.message) {
                                    errorResponseMessage += ` - ${errorData.error.message}`;
                                    if (errorStatus !== 401 && errorStatus !== 403) modalErrorMessage += ` Detay: ${errorData.error.message}`;
                                } else {
                                    errorResponseMessage += ` - YanÄ±t: ${errorBody.substring(0, 200)}${errorBody.length > 200 ? '...' : ''}`;
                                    if (errorStatus !== 401 && errorStatus !== 403) modalErrorMessage += ` Sunucu yanÄ±tÄ±: ${errorBody.substring(0,100)}...`;
                                }
                                console.error('API Hata DetayÄ± (JSON):', errorData);
                            } catch (e) {
                                errorResponseMessage += ` - YanÄ±t: ${errorBody.substring(0, 200)}${errorBody.length > 200 ? '...' : ''}`;
                                if (errorStatus !== 401 && errorStatus !== 403) modalErrorMessage += ` Sunucu yanÄ±tÄ± (JSON deÄŸil): ${errorBody.substring(0,100)}...`;
                                console.error('API Hata Metni (JSON deÄŸil):', errorBody);
                            }
                        } else {
                            errorResponseMessage += " - Sunucudan boÅŸ hata yanÄ±tÄ± alÄ±ndÄ±.";
                            if (errorStatus !== 401 && errorStatus !== 403) modalErrorMessage += " Sunucudan boÅŸ yanÄ±t alÄ±ndÄ±.";
                            console.error('API Hata: Sunucudan boÅŸ yanÄ±t alÄ±ndÄ±.');
                        }
                    } catch (textError) {
                        errorResponseMessage += " - Hata yanÄ±tÄ± okunamadÄ±.";
                        if (errorStatus !== 401 && errorStatus !== 403) modalErrorMessage += " Hata yanÄ±tÄ± sunucudan okunamadÄ±.";
                        console.error('API Hata: Hata yanÄ±tÄ± okunamadÄ±', textError);
                    }
                    showModal('Analiz HatasÄ±', modalErrorMessage, true);
                    analysisResultDiv.textContent = `Bir hata oluÅŸtu: ${errorResponseMessage}. LÃ¼tfen konsolu kontrol edin.`;
                    resultsSection.classList.remove('hidden');
                    setTimeout(() => resultsSection.classList.add('visible'), 50);
                    return;
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0 &&
                    result.candidates[0].content.parts[0].text) {
                    const analysisText = result.candidates[0].content.parts[0].text;
                    analysisResultDiv.textContent = analysisText;
                    resultsSection.classList.remove('hidden');
                    setTimeout(() => resultsSection.classList.add('visible'), 50); // Animasyon iÃ§in
                    showModal('Analiz TamamlandÄ±', 'Bitki analiziniz baÅŸarÄ±yla tamamlandÄ±. SonuÃ§larÄ± aÅŸaÄŸÄ±da gÃ¶rebilirsiniz.', false);
                } else {
                    // ... (Unexpected API response format handling remains the same)
                    console.error('API YanÄ±t FormatÄ± Beklenmedik:', result);
                     let detailedError = 'Yapay zekadan geÃ§erli bir analiz alÄ±namadÄ±.';
                    if (result.promptFeedback && result.promptFeedback.blockReason) {
                        detailedError += ` Engelleme nedeni: ${result.promptFeedback.blockReason.reason || result.promptFeedback.blockReason}`;
                        if (result.promptFeedback.safetyRatings) {
                             detailedError += ` GÃ¼venlik deÄŸerlendirmeleri: ${JSON.stringify(result.promptFeedback.safetyRatings)}`;
                        }
                    } else if (result.candidates && result.candidates.length > 0 && result.candidates[0].finishReason && result.candidates[0].finishReason !== 'STOP') {
                         detailedError += ` Bitirme nedeni: ${result.candidates[0].finishReason}.`;
                         if (result.candidates[0].safetyRatings) {
                            detailedError += ` GÃ¼venlik deÄŸerlendirmeleri: ${JSON.stringify(result.candidates[0].safetyRatings)}`;
                         }
                    }
                    showModal('Analiz HatasÄ±', detailedError, true);
                    analysisResultDiv.textContent = detailedError;
                    resultsSection.classList.remove('hidden');
                     setTimeout(() => resultsSection.classList.add('visible'), 50);
                }

            } catch (error) {
                console.error('Analiz sÄ±rasÄ±nda genel hata:', error);
                if (infoModal.style.display !== 'flex' || !infoModal.classList.contains('active')) {
                    showModal('Analiz HatasÄ±', `Beklenmedik bir sorun oluÅŸtu: ${error.message}. GeliÅŸtirici konsolunu kontrol edin.`, true);
                }
                if (!analysisResultDiv.textContent) {
                    analysisResultDiv.textContent = `Bir hata oluÅŸtu: ${error.message}.`;
                }
                resultsSection.classList.remove('hidden');
                setTimeout(() => resultsSection.classList.add('visible'), 50);
            } finally {
                loader.classList.add('hidden');
                analyzeButton.disabled = imageFilesData.length === 0;
                clearButton.disabled = false;
            }
        });

        // Sayfa yÃ¼klendiÄŸinde animasyonlarÄ± tetikle
        document.addEventListener('DOMContentLoaded', () => {
            resetForm();
            const sections = document.querySelectorAll('.animated-section');
            sections.forEach((section, index) => {
                // Her bir bÃ¶lÃ¼m iÃ§in gecikmeli olarak 'visible' class'Ä±nÄ± ekle
                setTimeout(() => {
                    section.classList.add('visible');
                }, index * 150); // 150ms aralÄ±klarla
            });
        });
    </script>
</body>
</html>
